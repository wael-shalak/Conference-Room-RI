<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relief International Conference Rooms Booking</title>
    <style>
        /* Your existing CSS styles */
    </style>
</head>
<body>
    <div class="container">
        <!-- Add the Relief International logo -->
        <img src="relief-international-logo.png" alt="Relief International Logo" class="logo">
        
        <h1>Relief International Conference Rooms Booking</h1>
        
        <div class="form-group">
            <label for="bookerName">Booker's Name:</label>
            <input type="text" id="bookerName" required>
        </div>
        <div class="form-group">
            <label for="date">Select Date:</label>
            <input type="date" id="date" required>
        </div>
        <div class="form-group">
            <label for="startTime">Select Start Time:</label>
            <input type="time" id="startTime" required>
        </div>
        <div class="form-group">
            <label for="endTime">Select End Time:</label>
            <input type="time" id="endTime" required>
        </div>
        <div class="form-group">
            <label for="room">Select Room:</label>
            <select id="room" required>
                <option value="Beirut Conference Room">Beirut Conference Room</option>
                <option value="Zahle Conference Room">Zahle Conference Room</option>
                <option value="Koura Conference Room">Koura Conference Room</option>
            </select>
        </div>
        <button onclick="bookRoom()">Book Room</button>
        
        <div class="booking-list" id="bookingList"></div>
        <div class="pagination" id="paginationControls"></div>

        <!-- Add credits at the bottom -->
        <div class="credits">
            Created by Wael Shalak
        </div>
    </div>

    <script>
        const googleScriptUrl = 'https://script.google.com/macros/s/AKfycby2-MGmaOn9ZEiDLLsjAfZ_0eSVMwE7dfr2uY4A6e-54G7srcdJU1fBfTGXdsuDwU22VQ/exec';
        const bookings = [];
        const itemsPerPage = 5;
        let currentPage = 1;

        async function bookRoom() {
            const bookerName = document.getElementById('bookerName').value;
            const date = document.getElementById('date').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const room = document.getElementById('room').value;

            if (!bookerName || !date || !startTime || !endTime || !room) {
                alert('Please fill all fields.');
                return;
            }

            // Check for conflicts
            const conflict = bookings.some(booking =>
                booking.date === date &&
                booking.room === room &&
                ((startTime >= booking.startTime && startTime < booking.endTime) ||
                (endTime > booking.startTime && endTime <= booking.endTime) ||
                (startTime <= booking.startTime && endTime >= booking.endTime))
            );

            if (conflict) {
                alert('This room is already booked during the selected time. Please choose another time or room.');
                return;
            }

            // Send data to Google Apps Script
            try {
                const response = await fetch(googleScriptUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ bookerName, date, startTime, endTime, room })
                });

                if (response.ok) {
                    alert('Room booked successfully!');
                    fetchBookings();
                } else {
                    const errorText = await response.text();
                    console.error('Failed to book room:', errorText);
                    alert('Failed to book room.');
                }
            } catch (error) {
                console.error('Error booking room:', error);
                alert('Error booking room.');
            }
        }

        async function fetchBookings() {
            try {
                const response = await fetch(googleScriptUrl);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                bookings.length = 0; // Clear existing bookings
                data.forEach(row => {
                    bookings.push({
                        bookerName: row[0],
                        date: row[1],
                        startTime: row[2],
                        endTime: row[3],
                        room: row[4]
                    });
                });
                bookings.sort((a, b) => new Date(`${a.date}T${a.startTime}`) - new Date(`${b.date}T${b.startTime}`)); // Sort by date and time
                displayBookings();
            } catch (error) {
                console.error('Error fetching bookings:', error);
            }
        }

        function displayBookings() {
            const bookingList = document.getElementById('bookingList');
            const paginationControls = document.getElementById('paginationControls');
            bookingList.innerHTML = '';
            paginationControls.innerHTML = '';

            const totalPages = Math.ceil(bookings.length / itemsPerPage);

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, bookings.length);
            const currentBookings = bookings.slice(startIndex, endIndex);

            currentBookings.forEach(booking => {
                const bookingItem = document.createElement('div');
                bookingItem.className = 'booking-item';
                bookingItem.textContent = `Booker: ${booking.bookerName} | Date: ${booking.date} | Time: ${booking.startTime} - ${booking.endTime} | Room: ${booking.room}`;
                bookingList.appendChild(bookingItem);
            });

            // Pagination controls
            if (totalPages > 1) {
                const createButton = (text, page, disabled = false) => {
                    const button = document.createElement('button');
                    button.textContent = text;
                    button.disabled = disabled;
                    button.className = disabled ? 'disabled' : '';
                    button.onclick = () => {
                        if (!disabled) {
                            currentPage = page;
                            displayBookings();
                        }
                    };
                    return button;
                };

                paginationControls.appendChild(createButton('First', 1, currentPage === 1));
                paginationControls.appendChild(createButton('Prev', currentPage - 1, currentPage === 1));

                for (let i = 1; i <= totalPages; i++) {
                    const pageButton = createButton(i, i);
                    if (i === currentPage) pageButton.style.fontWeight = 'bold';
                    paginationControls.appendChild(pageButton);
                }

                paginationControls.appendChild(createButton('Next', currentPage + 1, currentPage === totalPages));
                paginationControls.appendChild(createButton('Last', totalPages, currentPage === totalPages));
            }
        }

        fetchBookings(); // Initial load
    </script>
</body>
</html>
